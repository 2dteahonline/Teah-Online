// ===================== LEVEL SYSTEM =====================
// Shared data: used by both server and client
// Extracted from index_2.html — Phase A, Step 1

const TILE = 48;

function collisionFromAscii(asciiRows) {
  return asciiRows.map(row => row.split('').map(ch => (ch === '#' || ch === '@' ? 1 : 0)));
}

function tileToWorld(tx, ty) {
  return { x: tx * TILE + TILE / 2, y: ty * TILE + TILE / 2 };
}

// ---- LEVEL DATA (INLINE) ----
const LEVELS = {
  lobby_01: {
    id: 'lobby_01',
    widthTiles: 56,
    heightTiles: 46,
    isLobby: true,
    spawns: { p1: { tx: 28, ty: 30 } },
    collisionAscii: [
      "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@......................................................@",
      "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    ],
    entities: [
      // === FOUNTAIN (center, 8x8) ===
      { type: 'fountain', tx: 23, ty: 18, w: 10, h: 10, solid: true },
      // === PATHS ===
      { type: 'path_v', tx: 27, ty: 2, w: 2, h: 42, solid: false },
      { type: 'path_h', tx: 2, ty: 22, w: 52, h: 2, solid: false },
      // === TOWER BUILDING (top center) ===
      { type: 'tower_exterior', tx: 22, ty: 0, w: 12, h: 7, solid: true },
      { type: 'cave_entrance', tx: 26, ty: 6, w: 4, h: 2, solid: false, target: 'cave_01', spawnTX: 15, spawnTY: 19 },
      // === LEFT SIDE BUILDINGS (lined up with tower) ===
      { type: 'building_shop', tx: 2, ty: 0, w: 7, h: 7, solid: true },
      { type: 'building_house', tx: 9, ty: 0, w: 6, h: 7, solid: true },
      { type: 'building_tavern', tx: 15, ty: 0, w: 7, h: 7, solid: true },
      // === RIGHT SIDE BUILDINGS (lined up with tower) ===
      { type: 'building_mine', tx: 34, ty: 0, w: 7, h: 7, solid: true },
      { type: 'mine_entrance', tx: 36, ty: 6, w: 3, h: 2, solid: false, target: 'mine_01', spawnTX: 35, spawnTY: 44 },
      { type: 'building_chapel', tx: 41, ty: 0, w: 6, h: 7, solid: true },
      { type: 'building_azurine', tx: 47, ty: 0, w: 7, h: 7, solid: true },
      { type: 'azurine_entrance', tx: 49, ty: 6, w: 3, h: 2, solid: false, target: 'azurine_01', spawnTX: 20, spawnTY: 19 },
      // === TREES (varied sizes: 0=large oak, 1=medium pine, 2=small birch) ===
      { type: 'tree', tx: 8, ty: 29, solid: true, variant: 1 },
      { type: 'tree', tx: 16, ty: 33, solid: true, variant: 0 },
      { type: 'tree', tx: 44, ty: 29, solid: true, variant: 2 },
      { type: 'tree', tx: 38, ty: 35, solid: true, variant: 1 },
      { type: 'tree', tx: 4, ty: 38, solid: true, variant: 2 },
      { type: 'tree', tx: 52, ty: 36, solid: true, variant: 0 },
      { type: 'tree', tx: 19, ty: 14, solid: true, variant: 1 },
      { type: 'tree', tx: 37, ty: 14, solid: true, variant: 0 },
      { type: 'tree', tx: 10, ty: 18, solid: true, variant: 2 },
      { type: 'tree', tx: 46, ty: 18, solid: true, variant: 1 },
      { type: 'tree', tx: 35, ty: 40, solid: true, variant: 0 },
      { type: 'tree', tx: 20, ty: 40, solid: true, variant: 2 },
      // === FLOWER PATCHES ===
      { type: 'flower', tx: 8, ty: 12, solid: false },
      { type: 'flower', tx: 18, ty: 16, solid: false },
      { type: 'flower', tx: 40, ty: 10, solid: false },
      { type: 'flower', tx: 46, ty: 16, solid: false },
      { type: 'flower', tx: 10, ty: 30, solid: false },
      { type: 'flower', tx: 42, ty: 32, solid: false },
      { type: 'flower', tx: 14, ty: 38, solid: false },
      { type: 'flower', tx: 38, ty: 38, solid: false },
      { type: 'flower', tx: 6, ty: 20, solid: false },
      { type: 'flower', tx: 48, ty: 20, solid: false },
      // === LAMP POSTS (along paths) ===
      { type: 'lamp', tx: 25, ty: 10, solid: true },
      { type: 'lamp', tx: 30, ty: 10, solid: true },
      { type: 'lamp', tx: 25, ty: 34, solid: true },
      { type: 'lamp', tx: 30, ty: 34, solid: true },
      { type: 'lamp', tx: 14, ty: 22, solid: true },
      { type: 'lamp', tx: 40, ty: 22, solid: true },
      // === BENCHES (in grass areas, away from fountain) ===
      { type: 'bench', tx: 7, ty: 10, solid: true, dir: 0 },
      { type: 'bench', tx: 46, ty: 10, solid: true, dir: 0 },
      { type: 'bench', tx: 7, ty: 26, solid: true, dir: 0 },
      { type: 'bench', tx: 46, ty: 26, solid: true, dir: 0 },
      { type: 'bench', tx: 12, ty: 36, solid: true, dir: 0 },
      { type: 'bench', tx: 42, ty: 36, solid: true, dir: 0 },
      { type: 'bench', tx: 15, ty: 12, solid: true, dir: 0 },
      { type: 'bench', tx: 39, ty: 12, solid: true, dir: 0 },
      // === PICNIC TABLES (with chairs) ===
      { type: 'table', tx: 8, ty: 14, w: 3, h: 3, solid: true },
      { type: 'table', tx: 44, ty: 14, w: 3, h: 3, solid: true },
      { type: 'table', tx: 8, ty: 34, w: 3, h: 3, solid: true },
      { type: 'table', tx: 44, ty: 34, w: 3, h: 3, solid: true },
      // === BUSHES ===
      { type: 'bush', tx: 4, ty: 6, solid: true },
      { type: 'bush', tx: 50, ty: 6, solid: true },
      { type: 'bush', tx: 4, ty: 42, solid: true },
      { type: 'bush', tx: 50, ty: 42, solid: true },
      { type: 'bush', tx: 15, ty: 8, solid: true },
      { type: 'bush', tx: 40, ty: 8, solid: true },
      { type: 'bush', tx: 18, ty: 40, solid: true },
      { type: 'bush', tx: 37, ty: 40, solid: true },
      // === DELI BUILDING (left side, below shops) ===
      { type: 'building_deli', tx: 2, ty: 8, w: 7, h: 7, solid: true },
      { type: 'deli_entrance', tx: 4, ty: 14, w: 3, h: 2, solid: false, target: 'deli_01', spawnTX: 14, spawnTY: 27 },
      // === HOUSE ENTRANCE (below building_house) ===
      { type: 'house_entrance', tx: 10, ty: 6, w: 3, h: 2, solid: false, target: 'house_01', spawnTX: 10, spawnTY: 26 },
      // === FISHING DOCK (bottom-center, end of south path) ===
      { type: 'fishing_spot', tx: 26, ty: 42, w: 4, h: 2, solid: false },
      { type: 'fish_vendor', tx: 23, ty: 40, w: 2, h: 2, solid: true },
    ]
  },
  // === HOUSE / FARM INTERIOR ===
  // Top rows 0-2: stone walls (border)
  // Rows 3-18, cols 3-17: farm plot zone (open dirt, tillable)
  // Rows 3-18, cols 19-36: farm plot zone (open dirt, tillable) — right side
  // Rows 20-26: indoor wooden floor area (vendor, furniture)
  // Row 27: exit portal at bottom center
  house_01: {
    id: 'house_01',
    widthTiles: 40,
    heightTiles: 30,
    isFarm: true,
    spawns: { p1: { tx: 10, ty: 26 } },
    collisionAscii: [
      "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@@@@@@@@@@@....@@@@@@@@@@@@@@@@@@@@@@@@@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@......................................@",
      "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    ],
    entities: [
      // === EXIT (bottom center, back to lobby) ===
      { type: 'house_exit', tx: 8, ty: 27, w: 4, h: 3, solid: false, target: 'lobby_01', spawnTX: 11, spawnTY: 8 },
      // === FARM ZONE (defines tillable area — rows 1-18, cols 1-38) ===
      { type: 'farm_zone', tx: 1, ty: 1, w: 38, h: 18, solid: false },
      // === INDOOR AREA ENTITIES (rows 20-28) ===
      { type: 'farm_vendor', tx: 30, ty: 21, w: 2, h: 2, solid: true },
      // Furniture (cosmetic / solid)
      { type: 'farm_table', tx: 22, ty: 21, w: 3, h: 2, solid: true },
      { type: 'farm_bed', tx: 35, ty: 22, w: 2, h: 3, solid: true },
      { type: 'farm_chest', tx: 26, ty: 21, w: 2, h: 2, solid: true },
      { type: 'farm_well', tx: 2, ty: 21, w: 2, h: 2, solid: true },
    ]
  },
  cave_01: {
    id: 'cave_01',
    widthTiles: 40,
    heightTiles: 24,
    isCave: true,
    spawns: { p1: { tx: 20, ty: 19 } },
    collisionAscii: [
      "########################################",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "########################################"
    ],
    entities: [
      { type: 'cave_exit', tx: 17, ty: 21, w: 6, h: 3, solid: false, target: 'lobby_01', spawnTX: 28, spawnTY: 8 },
      { type: 'dungeon_door', tx: 17, ty: 1, w: 6, h: 3, solid: true },
      { type: 'queue_zone', tx: 15, ty: 4, w: 10, h: 5, solid: false, dungeonId: 'warehouse_01', spawnTX: 20, spawnTY: 20, maxPlayers: 4, floorStart: 1, dungeonType: 'cave' },
      // Left torches
      { type: 'torch', tx: 1, ty: 1, solid: false },
      { type: 'torch', tx: 1, ty: 4, solid: false },
      { type: 'torch', tx: 1, ty: 7, solid: false },
      { type: 'torch', tx: 1, ty: 10, solid: false },
      { type: 'torch', tx: 1, ty: 13, solid: false },
      { type: 'torch', tx: 1, ty: 16, solid: false },
      { type: 'torch', tx: 1, ty: 19, solid: false },
      { type: 'torch', tx: 1, ty: 22, solid: false },
      // Right torches (mirrored)
      { type: 'torch', tx: 38, ty: 1, solid: false },
      { type: 'torch', tx: 38, ty: 4, solid: false },
      { type: 'torch', tx: 38, ty: 7, solid: false },
      { type: 'torch', tx: 38, ty: 10, solid: false },
      { type: 'torch', tx: 38, ty: 13, solid: false },
      { type: 'torch', tx: 38, ty: 16, solid: false },
      { type: 'torch', tx: 38, ty: 19, solid: false },
      { type: 'torch', tx: 38, ty: 22, solid: false },
      // Door torches
      { type: 'torch', tx: 15, ty: 1, solid: false },
      { type: 'torch', tx: 24, ty: 1, solid: false },
      // Symmetrical rocks
      { type: 'rock', tx: 5, ty: 10, solid: true },
      { type: 'rock', tx: 34, ty: 10, solid: true },
      { type: 'rock', tx: 6, ty: 15, solid: true },
      { type: 'rock', tx: 33, ty: 15, solid: true },
      { type: 'rock', tx: 7, ty: 20, solid: true },
      { type: 'rock', tx: 32, ty: 20, solid: true },
    ]
  },
  // === AZURINE CITY INTERIOR (neon cyberpunk lobby → queue to dungeon) ===
  azurine_01: {
    id: 'azurine_01',
    widthTiles: 40,
    heightTiles: 24,
    isAzurine: true,
    spawns: { p1: { tx: 20, ty: 19 } },
    collisionAscii: [
      "########################################",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "########################################"
    ],
    entities: [
      { type: 'azurine_exit', tx: 17, ty: 21, w: 6, h: 3, solid: false, target: 'lobby_01', spawnTX: 50, spawnTY: 8 },
      { type: 'dungeon_door', tx: 17, ty: 1, w: 6, h: 3, solid: true },
      { type: 'queue_zone', tx: 15, ty: 4, w: 10, h: 5, solid: false, dungeonId: 'warehouse_01', spawnTX: 20, spawnTY: 20, maxPlayers: 4, floorStart: 1, dungeonType: 'azurine' },
      // Neon lights (left wall)
      { type: 'neon_light', tx: 1, ty: 1, solid: false },
      { type: 'neon_light', tx: 1, ty: 4, solid: false },
      { type: 'neon_light', tx: 1, ty: 7, solid: false },
      { type: 'neon_light', tx: 1, ty: 10, solid: false },
      { type: 'neon_light', tx: 1, ty: 13, solid: false },
      { type: 'neon_light', tx: 1, ty: 16, solid: false },
      { type: 'neon_light', tx: 1, ty: 19, solid: false },
      { type: 'neon_light', tx: 1, ty: 22, solid: false },
      // Neon lights (right wall)
      { type: 'neon_light', tx: 38, ty: 1, solid: false },
      { type: 'neon_light', tx: 38, ty: 4, solid: false },
      { type: 'neon_light', tx: 38, ty: 7, solid: false },
      { type: 'neon_light', tx: 38, ty: 10, solid: false },
      { type: 'neon_light', tx: 38, ty: 13, solid: false },
      { type: 'neon_light', tx: 38, ty: 16, solid: false },
      { type: 'neon_light', tx: 38, ty: 19, solid: false },
      { type: 'neon_light', tx: 38, ty: 22, solid: false },
      // Door lights
      { type: 'neon_light', tx: 15, ty: 1, solid: false },
      { type: 'neon_light', tx: 24, ty: 1, solid: false },
    ]
  },
  warehouse_01: {
    id: 'warehouse_01',
    widthTiles: 40,
    heightTiles: 40,
    spawns: {
      p1: { tx: 5, ty: 20 },
      p2: { tx: 34, ty: 20 }
    },
    collisionAscii: [
      "########################################",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#.........##................##.........#",
      "#.........##................##.........#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#.........##................##.........#",
      "#.........##................##.........#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "#......................................#",
      "########################################"
    ],
    entities: [
      { type: 'spawnPad', tx: 5, ty: 20, solid: false },
      { type: 'spawnPad', tx: 34, ty: 20, solid: false },
      { type: 'barrierV', tx: 1, ty: 1, w: 1, h: 4, solid: true },
      { type: 'barrierH', tx: 1, ty: 1, w: 4, h: 1, solid: true },
      { type: 'barrierV', tx: 38, ty: 1, w: 1, h: 4, solid: true },
      { type: 'barrierH', tx: 35, ty: 1, w: 4, h: 1, solid: true },
      { type: 'barrierV', tx: 1, ty: 35, w: 1, h: 4, solid: true },
      { type: 'barrierH', tx: 1, ty: 38, w: 4, h: 1, solid: true },
      { type: 'barrierV', tx: 38, ty: 35, w: 1, h: 4, solid: true },
      { type: 'barrierH', tx: 35, ty: 38, w: 4, h: 1, solid: true },
      { type: 'zone', id: 'center', tx: 14, ty: 14, w: 12, h: 12, solid: false }
    ]
  },
  mine_01: {
    id: 'mine_01',
    widthTiles: 70,
    heightTiles: 48,
    isMine: true,
    spawns: { p1: { tx: 35, ty: 44 } },
    collisionAscii: [
      "######################################################################",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#..........##........................................................#",
      "#..........##........................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.......................................##...........................#",
      "#.......................................##...........................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.....................##.............................................#",
      "#.....................##.............................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#..................................................##................#",
      "#..................................................##................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.......................##...........................................#",
      "#.......................##...........................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.........................................................##.........#",
      "#.........................................................##.........#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "######################################################################"
    ],
    entities: [
      { type: 'mine_exit', tx: 33, ty: 45, w: 4, h: 3, solid: false, target: 'lobby_01', spawnTX: 37, spawnTY: 8 },
      // Door to Room 2 (top of room)
      { type: 'mine_door', tx: 33, ty: 1, w: 4, h: 2, solid: false, target: 'mine_02', spawnTX: 35, spawnTY: 44, label: 'ROOM 2 \u2192' },
      // Torches — left wall
      { type: 'torch', tx: 1, ty: 1, solid: false },
      { type: 'torch', tx: 1, ty: 10, solid: false },
      { type: 'torch', tx: 1, ty: 20, solid: false },
      { type: 'torch', tx: 1, ty: 30, solid: false },
      { type: 'torch', tx: 1, ty: 40, solid: false },
      { type: 'torch', tx: 1, ty: 46, solid: false },
      // Torches — right wall
      { type: 'torch', tx: 68, ty: 1, solid: false },
      { type: 'torch', tx: 68, ty: 10, solid: false },
      { type: 'torch', tx: 68, ty: 20, solid: false },
      { type: 'torch', tx: 68, ty: 30, solid: false },
      { type: 'torch', tx: 68, ty: 40, solid: false },
      { type: 'torch', tx: 68, ty: 46, solid: false },
      // Center torches
      { type: 'torch', tx: 34, ty: 6, solid: false },
      { type: 'torch', tx: 34, ty: 24, solid: false },
    ]
  },
  mine_02: {
    id: 'mine_02',
    widthTiles: 70,
    heightTiles: 48,
    isMine: true,
    spawns: { p1: { tx: 35, ty: 44 } },
    collisionAscii: [
      "######################################################################",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#...............................##...................................#",
      "#...............................##...................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.........##.........................................................#",
      "#.........##.........................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#...............................................................##...#",
      "#...............................................................##...#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#......................##............................................#",
      "#......................##............................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#............................................##......................#",
      "#............................................##......................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "######################################################################"
    ],
    entities: [
      // Door back to Room 1 (bottom)
      { type: 'mine_door', tx: 33, ty: 45, w: 4, h: 2, solid: false, target: 'mine_01', spawnTX: 35, spawnTY: 3, label: '\u2190 ROOM 1' },
      // Door to Room 3 (top)
      { type: 'mine_door', tx: 33, ty: 1, w: 4, h: 2, solid: false, target: 'mine_03', spawnTX: 35, spawnTY: 44, label: 'ROOM 3 \u2192' },
      // Torches — left wall
      { type: 'torch', tx: 1, ty: 1, solid: false },
      { type: 'torch', tx: 1, ty: 15, solid: false },
      { type: 'torch', tx: 1, ty: 30, solid: false },
      { type: 'torch', tx: 1, ty: 46, solid: false },
      // Torches — right wall
      { type: 'torch', tx: 68, ty: 1, solid: false },
      { type: 'torch', tx: 68, ty: 15, solid: false },
      { type: 'torch', tx: 68, ty: 30, solid: false },
      { type: 'torch', tx: 68, ty: 46, solid: false },
    ]
  },
  mine_03: {
    id: 'mine_03',
    widthTiles: 70,
    heightTiles: 48,
    isMine: true,
    spawns: { p1: { tx: 35, ty: 44 } },
    collisionAscii: [
      "######################################################################",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.................##.................................................#",
      "#.................##.................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#...........................................................##.......#",
      "#...........................................................##.......#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.......##...........................................................#",
      "#.......##...........................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.........................................##.........................#",
      "#.........................................##.........................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#............................##......................................#",
      "#............................##......................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "######################################################################"
    ],
    entities: [
      // Door back to Room 2 (bottom)
      { type: 'mine_door', tx: 33, ty: 45, w: 4, h: 2, solid: false, target: 'mine_02', spawnTX: 35, spawnTY: 3, label: '\u2190 ROOM 2' },
      // Door to Room 4 (top)
      { type: 'mine_door', tx: 33, ty: 1, w: 4, h: 2, solid: false, target: 'mine_04', spawnTX: 35, spawnTY: 44, label: 'ROOM 4 \u2192' },
      // Torches — left wall
      { type: 'torch', tx: 1, ty: 1, solid: false },
      { type: 'torch', tx: 1, ty: 15, solid: false },
      { type: 'torch', tx: 1, ty: 30, solid: false },
      { type: 'torch', tx: 1, ty: 46, solid: false },
      // Torches — right wall
      { type: 'torch', tx: 68, ty: 1, solid: false },
      { type: 'torch', tx: 68, ty: 15, solid: false },
      { type: 'torch', tx: 68, ty: 30, solid: false },
      { type: 'torch', tx: 68, ty: 46, solid: false },
    ]
  },
  mine_04: {
    id: 'mine_04',
    widthTiles: 70,
    heightTiles: 48,
    isMine: true,
    spawns: { p1: { tx: 35, ty: 44 } },
    collisionAscii: [
      "######################################################################",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.............................................##.....................#",
      "#.............................................##.....................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.........................##.........................................#",
      "#.........................##.........................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.........##.........................................................#",
      "#.........##.........................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#................................................##..................#",
      "#................................................##..................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#....................................................................#",
      "#.......................##...........................................#",
      "#.......................##...........................................#",
      "#....................................................................#",
      "#....................................................................#",
      "######################################################################"
    ],
    entities: [
      // Door back to Room 3 (bottom) — deepest room, no forward exit
      { type: 'mine_door', tx: 33, ty: 45, w: 4, h: 2, solid: false, target: 'mine_03', spawnTX: 35, spawnTY: 3, label: '\u2190 ROOM 3' },
      // Torches — left wall
      { type: 'torch', tx: 1, ty: 1, solid: false },
      { type: 'torch', tx: 1, ty: 15, solid: false },
      { type: 'torch', tx: 1, ty: 30, solid: false },
      { type: 'torch', tx: 1, ty: 46, solid: false },
      // Torches — right wall
      { type: 'torch', tx: 68, ty: 1, solid: false },
      { type: 'torch', tx: 68, ty: 15, solid: false },
      { type: 'torch', tx: 68, ty: 30, solid: false },
      { type: 'torch', tx: 68, ty: 46, solid: false },
      // Extra center torches (deepest room is darker)
      { type: 'torch', tx: 34, ty: 10, solid: false },
      { type: 'torch', tx: 34, ty: 30, solid: false },
    ]
  },
  // ===================== DELI (COOKING) =====================
  deli_01: {
    id: 'deli_01',
    widthTiles: 50,
    heightTiles: 30,
    isCooking: true,
    spawns: { p1: { tx: 14, ty: 27 } },
    collisionAscii: [
      "##################################################",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "#................................................#",
      "##################################################"
    ],
    entities: [
      // Exit door (bottom)
      { type: 'deli_exit', tx: 12, ty: 27, w: 4, h: 3, solid: false, target: 'lobby_01', spawnTX: 5, spawnTY: 16 },

      // === KITCHEN FLOOR (rendered behind everything — tile pattern) ===
      { type: 'deli_kitchen_floor', tx: 1, ty: 1, w: 23, h: 20, solid: false },

      // === KITCHEN AREA (left side, 24 wide x 20 tall, rows 1-20) ===
      // Service counter wall — split around serve window + tip jar
      { type: 'deli_service_counter', tx: 1,  ty: 21, w: 7,  h: 1, solid: true }, // left segment
      { type: 'pickup_counter',       tx: 8,  ty: 21, w: 6,  h: 1, solid: true }, // serve window (in the wall)
      { type: 'tip_jar',              tx: 14, ty: 21, w: 2,  h: 1, solid: true }, // tip jar (in the wall)
      { type: 'deli_service_counter', tx: 16, ty: 21, w: 9,  h: 1, solid: true }, // right segment
      // Service counter — vertical bar on right side (rows 1-18, door at 19-20)
      { type: 'deli_service_counter', tx: 24, ty: 1, w: 1, h: 18, solid: true },
      // Kitchen door (right side)
      { type: 'kitchen_door', tx: 24, ty: 19, w: 1, h: 2, solid: false },

      // === INGREDIENT SECTIONS (organized by category, 2 tile gap between each) ===
      // -- BREADS section (top-left, row 1) --
      { type: 'ing_bread', tx: 1, ty: 1, w: 2, h: 2, solid: true },
      { type: 'ing_bagel', tx: 5, ty: 1, w: 2, h: 2, solid: true },

      // -- MEATS section (top-right, row 1) --
      { type: 'ing_turkey',  tx: 10, ty: 1, w: 2, h: 2, solid: true },
      { type: 'ing_chicken', tx: 14, ty: 1, w: 2, h: 2, solid: true },
      { type: 'ing_ham',     tx: 18, ty: 1, w: 2, h: 2, solid: true },
      { type: 'ing_salami',  tx: 22, ty: 1, w: 2, h: 2, solid: true },

      // -- VEGGIES section (left side, along wall) --
      { type: 'ing_lettuce', tx: 1, ty: 6,  w: 2, h: 2, solid: true },
      { type: 'ing_tomato',  tx: 1, ty: 9,  w: 2, h: 2, solid: true },
      { type: 'ing_cheese',  tx: 1, ty: 12, w: 2, h: 2, solid: true },
      { type: 'ing_onion',   tx: 1, ty: 15, w: 2, h: 2, solid: true },

      // -- SAUCES section (right side, along wall) --
      { type: 'ing_mayo',    tx: 21, ty: 7,  w: 2, h: 2, solid: true },
      { type: 'ing_ketchup', tx: 21, ty: 9,  w: 2, h: 2, solid: true },
      { type: 'ing_mustard', tx: 21, ty: 11, w: 2, h: 2, solid: true },
      { type: 'ing_ranch',   tx: 21, ty: 13, w: 2, h: 2, solid: true },

      // === WORK STATIONS ===
      // Deli Counter (center — clear plate)
      { type: 'deli_counter', tx: 9, ty: 8, w: 6, h: 2, solid: true },

      // === DINING AREA (right side — 4 tables, 2 cushions per side = 8 per table) ===
      // Table 1 (28,4) — 3w × 2h
      { type: 'deli_table', tx: 28, ty: 4, w: 3, h: 2, solid: true },
      { type: 'deli_chair', tx: 27, ty: 4, solid: false },   // left 1
      { type: 'deli_chair', tx: 27, ty: 5, solid: false },   // left 2
      { type: 'deli_chair', tx: 31, ty: 4, solid: false },   // right 1
      { type: 'deli_chair', tx: 31, ty: 5, solid: false },   // right 2
      { type: 'deli_chair', tx: 28, ty: 3, solid: false },   // top 1
      { type: 'deli_chair', tx: 30, ty: 3, solid: false },   // top 2
      { type: 'deli_chair', tx: 28, ty: 6, solid: false },   // bottom 1
      { type: 'deli_chair', tx: 30, ty: 6, solid: false },   // bottom 2

      // Table 2 (40,4) — 3w × 2h
      { type: 'deli_table', tx: 40, ty: 4, w: 3, h: 2, solid: true },
      { type: 'deli_chair', tx: 39, ty: 4, solid: false },
      { type: 'deli_chair', tx: 39, ty: 5, solid: false },
      { type: 'deli_chair', tx: 43, ty: 4, solid: false },
      { type: 'deli_chair', tx: 43, ty: 5, solid: false },
      { type: 'deli_chair', tx: 40, ty: 3, solid: false },
      { type: 'deli_chair', tx: 42, ty: 3, solid: false },
      { type: 'deli_chair', tx: 40, ty: 6, solid: false },
      { type: 'deli_chair', tx: 42, ty: 6, solid: false },

      // Table 3 (28,17) — 3w × 2h
      { type: 'deli_table', tx: 28, ty: 17, w: 3, h: 2, solid: true },
      { type: 'deli_chair', tx: 27, ty: 17, solid: false },
      { type: 'deli_chair', tx: 27, ty: 18, solid: false },
      { type: 'deli_chair', tx: 31, ty: 17, solid: false },
      { type: 'deli_chair', tx: 31, ty: 18, solid: false },
      { type: 'deli_chair', tx: 28, ty: 16, solid: false },
      { type: 'deli_chair', tx: 30, ty: 16, solid: false },
      { type: 'deli_chair', tx: 28, ty: 19, solid: false },
      { type: 'deli_chair', tx: 30, ty: 19, solid: false },

      // Table 4 (40,17) — 3w × 2h
      { type: 'deli_table', tx: 40, ty: 17, w: 3, h: 2, solid: true },
      { type: 'deli_chair', tx: 39, ty: 17, solid: false },
      { type: 'deli_chair', tx: 39, ty: 18, solid: false },
      { type: 'deli_chair', tx: 43, ty: 17, solid: false },
      { type: 'deli_chair', tx: 43, ty: 18, solid: false },
      { type: 'deli_chair', tx: 40, ty: 16, solid: false },
      { type: 'deli_chair', tx: 42, ty: 16, solid: false },
      { type: 'deli_chair', tx: 40, ty: 19, solid: false },
      { type: 'deli_chair', tx: 42, ty: 19, solid: false },

      // === CONDIMENT TABLE (center of dining area) ===
      { type: 'deli_condiment_table', tx: 34, ty: 11, w: 3, h: 2, solid: true },

      // === GROCERY AISLES (right side, below dining area) ===
      // All items (frozen, drinks, chips, soups, cookies, etc.) are in the aisles.
      // -- Aisle 1 (row 22-23) — 3 shelves, 2-tile gaps --
      { type: 'deli_shelf_frozen',    tx: 27, ty: 22, w: 5, h: 2, solid: true },
      { type: 'deli_shelf_snacks',    tx: 34, ty: 22, w: 5, h: 2, solid: true },
      { type: 'deli_shelf_drinks',    tx: 41, ty: 22, w: 5, h: 2, solid: true },

      // -- Aisle 2 (row 26-27) — 3 shelves, 2-tile gaps --
      { type: 'deli_shelf_cookies',   tx: 27, ty: 26, w: 5, h: 2, solid: true },
      { type: 'deli_shelf_soups',     tx: 34, ty: 26, w: 5, h: 2, solid: true },
      { type: 'deli_shelf_dairy',     tx: 41, ty: 26, w: 5, h: 2, solid: true },
    ]
  },
  // ---- TEST ARENA (dev only) ----
  test_arena: {
    id: 'test_arena',
    widthTiles: 36,
    heightTiles: 28,
    isTestArena: true,
    spawns: { p1: { tx: 18, ty: 10 } },
    collisionAscii: [
      "####################################",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "#..................................#",
      "####################################"
    ],
    entities: []
  }
};
